name: "routing"
version: '3.8'
services:
    traefik:
        image: traefik:v3.4
        container_name: traefik
        restart: always
        environment:
            # Only environment variables needed for providers
            - TZ=${TZ}
            - CF_DNS_API_TOKEN=${CF_DNS_API_TOKEN}
        # No command arguments - everything is in config files
        ports:
            - '80:80'          # HTTP
            - '443:443'        # HTTPS
            - '8080:8080'      # Traefik API/Dashboard
            - '8082:8082'      # Prometheus metrics
        volumes:
            - /var/run/docker.sock:/var/run/docker.sock:ro
            - traefik-certificates:/certificates
            - traefik-logs:/var/log/traefik
            # Mount both configuration files
            - traefik-config:/etc/traefik/traefik-static.yml:ro
            - traefik-config:/etc/traefik/traefik-dynamic.yml:ro
        networks:
            - traefik
        healthcheck:
            test: ["CMD", "traefik", "healthcheck", "--ping"]
            interval: 30s
            timeout: 3s
            retries: 3
            start_period: 10s

volumes:
    traefik-certificates:
        driver: local
    traefik-logs:
        driver: local
    traefik-config:
        driver: local

networks:
    traefik:
        external: true
