name: "routing"
version: '3.8'
services:
    traefik:
        image: traefik:v3.4
        container_name: traefik
        restart: always
        environment:
            # Only environment variables needed for providers
            - TZ=${TZ}
            # Removed CF_DNS_API_TOKEN as we're not using ACME anymore
        # No command arguments - everything is in config files
        ports:
            - '80:80'          # HTTP
            - '443:443'        # HTTPS
            - '8090:8080'      # Traefik API/Dashboard
            - '8082:8082'      # Prometheus metrics
        volumes:
            - /var/run/docker.sock:/var/run/docker.sock:ro
            - traefik-logs:/var/log/traefik
            # Mount configuration directory as bind mount for easier management
            - ./traefik:/etc/traefik:ro
        networks:
            - traefik
        healthcheck:
            test: ["CMD", "traefik", "healthcheck", "--ping"]
            interval: 30s
            timeout: 3s
            retries: 3
            start_period: 10s

volumes:
    traefik-logs:
        driver: local

networks:
    traefik:
        external: true
