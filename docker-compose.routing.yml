name: "routing"
version: '3.8'
services:
    traefik:
        image: traefik:v3.4
        container_name: traefik
        restart: always
        environment:
            - TZ=${TZ}
            - TRAEFIK_AUTH=${TRAEFIK_AUTH}
            - TRAEFIK_DOMAIN=${TRAEFIK_DOMAIN}
        command:
            # API and Dashboard
            - "--api.dashboard=true"
            - "--api.insecure=false"

            # Entry Points
            - "--entrypoints.web.address=:80"
            - "--entrypoints.websecure.address=:443"

            # Providers
            - "--providers.docker=true"
            - "--providers.docker.exposedbydefault=false"

            # Global settings
            - "--global.checknewversion=false"
            - "--global.sendanonymoususage=false"

            # Logging
            - "--log.level=INFO"

            # Prometheus Metrics
            - "--metrics.prometheus=true"
            - "--metrics.prometheus.addEntryPointsLabels=true"
            - "--metrics.prometheus.addServicesLabels=true"
            - "--metrics.prometheus.addRoutersLabels=true"
            - "--metrics.prometheus.buckets=0.1,0.3,1.2,5.0"
        ports:
            - '80:80'
            - '443:443'
            - '5000:8080'
            - '8082:8082'  # Prometheus metrics port
        volumes:
            - /var/run/docker.sock:/var/run/docker.sock:ro
        labels:
            - "traefik.enable=true"
            # Dashboard configuration
            - "traefik.http.routers.traefik.rule=Host(`${TRAEFIK_DOMAIN}`)"
            - "traefik.http.routers.traefik.entrypoints=websecure"
            - "traefik.http.routers.traefik.service=api@internal"
        networks:
            - traefik

networks:
    traefik:
        external: true
